#### Подготовливаем сертификаты
#### Создаём конфигурационный файл OpenSSL (openssl.cnf)
```
[ req ]
default_bits        = 2048
distinguished_name  = req_distinguished_name
req_extensions      = v3_req
prompt              = no
encrypt_key         = no

[ req_distinguished_name ]
countryName         = RU
stateOrProvinceName = Moscow
localityName        = Moscow
organizationName    = Rosreestr
commonName          = rosreestr.ru

[ v3_req ]
keyUsage            = keyEncipherment, dataEncipherment, digitalSignature
extendedKeyUsage    = serverAuth, clientAuth
subjectAltName      = @alt_names
basicConstraints    = CA:FALSE

[ alt_names ]
DNS.1  = rosreestr.ru
DNS.2  = www.rosreestr.ru
DNS.3  = *.rosreestr.ru
DNS.4  = *.r03.rosreestr.ru
DNS.5  = *.r07.rosreestr.ru
DNS.6  = *.r13.rosreestr.ru
DNS.7  = *.r41.rosreestr.ru
DNS.8  = *.r49.rosreestr.ru
DNS.9  = *.r63.rosreestr.ru
DNS.10 = *.r64.rosreestr.ru
DNS.11 = *.r76.rosreestr.ru
DNS.12 = *.r80.rosreestr.ru
DNS.13 = *.r81.rosreestr.ru
DNS.14 = *.r84.rosreestr.ru
DNS.15 = *.r85.rosreestr.ru
DNS.16 = *.r96.rosreestr.ru
DNS.17 = *.u82.rosreestr.ru
DNS.18 = *.u92.rosreestr.ru
DNS.19 = *.r66.rosreestr.ru  # Добавляем новый хост
```
#### Копируем их в папку /mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcer

<img width="1086" height="362" alt="image" src="https://github.com/user-attachments/assets/30372106-0619-4277-8a48-c8db862fc1e4" />

```
root@mx2:~# cd /mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert/
root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert#
root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert# ls -la
итого 28
drwxr-xr-x 2 root root 4096 ноя  2 16:16 .
drwxr-xr-x 6 root root 4096 мар  5  2025 ..
-rw-r--r-- 1 root root 1105 ноя  2 16:16 openssl.cnf
-rw-r--r-- 1 root root 3248 ноя  2 16:16 rosreestr.ru.crt
-rw-r--r-- 1 root root 1704 ноя  2 16:16 rosreestr.ru.key
-rw-r--r-- 1 root root 2057 ноя  2 16:16 Russian_Trusted_rootCA.pem
-rw-r--r-- 1 root root 2577 ноя  2 16:16 Russian_Trusted_subCA.pem
root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert#
```

#### Копируем их в папку /usr/local/share/ca-certificates/
```
root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert# cp rosreestr.ru.* /usr/local/share/ca-certificates/
root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert# ls /usr/local/share/ca-certificates/
rosreestr.ru.crt  rosreestr.ru.key
root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert#
```
#### Копируем в хранилиище сертификатов коренные сертификаты Минцифры 
```
root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert# cp Russian_Trusted_* /etc/ssl/certs/
```
#### Добавляем в хранилиище сертификатов и обновляем их
```
update-ca-certificates -v
update-ca-certificates --fresh
```
<img width="1131" height="63" alt="image" src="https://github.com/user-attachments/assets/62aa49e9-e6fa-4edc-b2ba-d36b05c4d2f1" />

<img width="1013" height="127" alt="image" src="https://github.com/user-attachments/assets/eb6e5e91-9dbf-462e-bfb0-efeee8f8931d" />

#### Теперь удаляем не нужные сертификаты из папки /mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcer

<img width="332" height="191" alt="image" src="https://github.com/user-attachments/assets/ce207ed9-14ee-4948-8eb6-83ee4058e712" />

#### Создать приватный ключ
```
openssl genrsa -out r66.rosreestr.ru.key 2048
```
#### Создать CSR (Certificate Signing Request)
```
openssl req -new -key r66.rosreestr.ru.key -out r66.rosreestr.ru.csr -config openssl.cnf
```
#### Сгенерировать самоподписной сертификат
```
openssl x509 -req -days 365 -in r66.rosreestr.ru.csr -signkey r66.rosreestr.ru.key -out r66.rosreestr.ru.crt -extensions v3_req -extfile openssl.cnf
```

```

root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert# ls /usr/local/share/ca-certificates/
rosreestr.ru.crt  rosreestr.ru.key
root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert# rm /usr/local/share/ca-certificates/*
root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert# ls /usr/local/share/ca-certificates/
root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert# cp r66.rosreestr.ru.crt /usr/local/share/ca-certificates/
root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert# cp r66.rosreestr.ru.key /usr/local/share/ca-certificates/
root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert# ls /usr/local/share/ca-certificates/
r66.rosreestr.ru.crt  r66.rosreestr.ru.key
root@mx2:/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert#

```
